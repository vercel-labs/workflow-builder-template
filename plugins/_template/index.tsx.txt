/**
 * PLUGIN INDEX TEMPLATE
 * 
 * This is the main plugin file that brings everything together.
 * It imports all the components and defines the plugin configuration.
 */

import { [LUCIDE_ICON_NAME] } from "lucide-react";
import type { IntegrationPlugin } from "../registry";
import { registerIntegration } from "../registry";
import { [actionName]CodegenTemplate } from "./codegen/[action-file]";
import { [IntegrationName]Icon } from "./icon";
import { [IntegrationName]Settings } from "./settings";
import { [ActionName]ConfigFields } from "./steps/[action-file]/config";
import { test[IntegrationName] } from "./test";

// Export step functions for workflow execution
export { [actionName]Step } from "./steps/[action-file]/step";

const [integrationId]Plugin: IntegrationPlugin = {
  type: "[integration-id]", // Must match type in lib/db/integrations.ts
  label: "[Integration Name]",
  description: "[Brief description of what this integration does]",

  // Icon configuration
  icon: {
    type: "svg", // or "lucide" for Lucide icons, or "image" for image files
    value: "[IntegrationName]Icon",
    svgComponent: [IntegrationName]Icon,
  },
  // For Lucide icons, use:
  // icon: {
  //   type: "lucide",
  //   value: "[ICON_NAME]", // e.g., "Zap", "Mail", "Send"
  // },

  // Settings component
  settingsComponent: [IntegrationName]Settings,

  // Form fields for the integration dialog
  formFields: [
    {
      id: "[integration-id]ApiKey",
      label: "API Key",
      type: "password",
      placeholder: "[api-key-prefix]...",
      configKey: "[integration-id]ApiKey", // Key in database config
      helpText: "Get your API key from ",
      helpLink: {
        text: "[integration-name].com",
        url: "[LINK_TO_API_KEYS]",
      },
    },
    // Add more fields as needed
  ],

  // Map config to environment variables
  credentialMapping: (config) => {
    const creds: Record<string, string> = {};
    if (config.[integration-id]ApiKey) {
      creds.[ENV_VAR_NAME] = String(config.[integration-id]ApiKey);
    }
    // Map additional fields
    return creds;
  },

  // Test connection function
  testConfig: {
    testFunction: test[IntegrationName],
  },

  // Actions provided by this integration
  actions: [
    {
      id: "[ACTION_ID]", // e.g., "Send Message", "Create Record"
      label: "[Action Label]",
      description: "[What this action does]",
      category: "[Integration Name]", // Usually the integration name
      icon: [LUCIDE_ICON_NAME], // Lucide icon component
      stepFunction: "[actionName]Step",
      stepImportPath: "[action-file]", // Relative to plugins/[plugin-name]/steps/
      configFields: [ActionName]ConfigFields,
      codegenTemplate: [actionName]CodegenTemplate, // The actual template string
    },
    // Add more actions as needed
  ],
};

// Auto-register on import
registerIntegration([integrationId]Plugin);

export default [integrationId]Plugin;

